/*!
* Blast.js: Blast text apart to make it manipulable.
* @version 1.0.0
* @dependency Works with both jQuery and Zepto.
* @docs julian.com/research/blast
* @license Copyright 2014 Julian Shapiro. MIT License: http://en.wikipedia.org/wiki/MIT_License
*/
!function($,e,t,n){var a=function(){if(t.documentMode)return t.documentMode;for(var e=7;e>0;e--){var a=t.createElement("div");if(a.innerHTML="<!--[if IE "+e+"]><span></span><![endif]-->",a.getElementsByTagName("span").length)return a=null,e;a=null}return n}(),r=e.console||{log:function(){},time:function(){}},i="blast",s={latinPunctuation:"–—′’'“″„\"(«.…¡¿′’'”″“\")».…!?",latinLetters:"\\u0041-\\u005A\\u0061-\\u007A\\u00C0-\\u017F\\u0100-\\u01FF\\u0180-\\u027F"},l={abbreviations:new RegExp("[^"+s.latinLetters+"](e\\.g\\.)|(i\\.e\\.)|(mr\\.)|(mrs\\.)|(ms\\.)|(dr\\.)|(prof\\.)|(esq\\.)|(sr\\.)|(jr\\.)[^"+s.latinLetters+"]","ig"),innerWordPeriod:new RegExp("["+s.latinLetters+"].["+s.latinLetters+"]","ig"),onlyContainsPunctuation:new RegExp("[^"+s.latinPunctuation+"]"),adjoinedPunctuation:new RegExp("^["+s.latinPunctuation+"]+|["+s.latinPunctuation+"]+$","g"),skippedElements:/(script|style|select|textarea)/i,hasPluginClass:new RegExp("(^| )"+i+"( |$)","gi")};$.fn[i]=function(e){function d(e){return e.replace(l.abbreviations,function(e){return e.replace(/\./g,"{{46}}")}).replace(l.innerWordPeriod,function(e){return e.replace(/\./g,"{{46}}")})}function o(e){return e.replace(/{{(\d{1,3})}}/g,function(e,t){return String.fromCharCode(t)})}function c(e,n){var a=t.createElement(n.tag);if(a.className=i,n.customClass&&(a.className+=" "+n.customClass,n.generateIndexID&&(a.id=n.customClass+"-"+p.blastedIndex)),n.generateValueClass===!0&&!n.search&&("character"===n.delimiter||"word"===n.delimiter)){var r,s=e.data;"word"===n.delimiter&&l.onlyContainsPunctuation.test(s)&&(s=s.replace(l.adjoinedPunctuation,"")),r=i+"-"+n.delimiter.toLowerCase()+"-"+s.toLowerCase(),a.className+=" "+r}return a.appendChild(e.cloneNode(!1)),a}function u(e,t){var n=-1,a=0;if(3===e.nodeType&&e.data.length){if(p.nodeBeginning&&(e.data=t.search||"sentence"!==t.delimiter?o(e.data):d(e.data),p.nodeBeginning=!1),n=e.data.search(h),-1!==n){var r=e.data.match(h),i=r[0],s=r[1]||!1;p.blastedIndex++,""===i?n++:s&&s!==i&&(n+=i.indexOf(s),i=s);var g=e.splitText(n);g.splitText(i.length),a=1,t.search||"sentence"!==t.delimiter||(g.data=o(g.data));var m=c(g,t,p.blastedIndex);g.parentNode.replaceChild(m,g),p.wrappers.push(m)}}else if(1===e.nodeType&&e.hasChildNodes()&&!l.skippedElements.test(e.tagName)&&!l.hasPluginClass.test(e.className))for(var f=0;f<e.childNodes.length;f++)p.nodeBeginning=!0,f+=u(e.childNodes[f],t);return a}function g(e,t){t.debug&&r.time("blast reversal");var s=!1;e.removeClass(i+"-root").data(i,n).find("."+i).each(function(){var e=$(this);if(e.closest("."+i+"-root").length)s=!0;else{var t=this.parentNode;7>=a&&t.firstChild.nodeName,t.replaceChild(this.firstChild,this),t.normalize()}}),t.debug&&(r.log(i+": Reversed Blast"+(e.attr("id")?" on #"+e.attr("id")+".":".")+(s?" Skipped reversal on the children of one or more descendant root elements.":"")),r.timeEnd("blast reversal"))}var m=$.extend({},$.fn[i].defaults,e),h,p={};if(!m.search.length||"string"!==$.type(m.search)&&"number"!==$.type(m.search))switch("string"===$.type(m.delimiter)&&(m.delimiter=m.delimiter.toLowerCase()),m.delimiter){case"letter":case"char":case"character":h=/(\S)/;break;case"word":h=/\s*(\S+)\s*/;break;case"sentence":h=/(?=\S)(([.]{2,})?[^!?]+?([.…!?]+|(?=\s+$)|$)(\s*[′’'”″“")»]+)*)/;break;case"element":h=/(?=\S)([\S\s]*\S)/;break;default:if(!(m.delimiter instanceof RegExp))return r.log(i+": Unrecognized delimiter, empty search string, or invalid custom Regex. Aborting."),!0;h=m.delimiter}else m.delimiter=m.search.toString().replace(/[-[\]{,}(.)*+?|^$\\\/]/g,"\\$&"),h=new RegExp("(?:^|[^-"+s.latinLetters+"])("+m.delimiter+"('s)?)(?![-"+s.latinLetters+"])","i");if(this.each(function(){var a=$(this);if(e!==!1){p={blastedIndex:0,nodeBeginning:!1,wrappers:[]},a.data(i)===n||"search"===a.data(i)&&m.search!==!1||(g(a,m),m.debug&&r.log(i+": Removing element's existing Blast call.")),a.data(i,m.search!==!1?"search":m.delimiter),m.stripHTMLTags&&a.html(a.text());try{t.createElement(m.tag)}catch(s){m.tag="span",m.debug&&r.log(i+": Invalid tag supplied. Defaulting to span.")}a.addClass(i+"-root"),m.debug&&r.time(i),u(this,m),m.debug&&r.timeEnd(i)}else e===!1&&a.data(i)!==n&&g(a,m);m.debug&&a.find(".blast").each(function(){r.log(i+" ["+m.delimiter+"] "+$(this)[0].outerHTML)}).filter(function(e,t){this.style.backgroundColor=e%2?"#f12185":"#075d9a"})}),e!==!1&&m.returnGenerated===!0){var f=$().add(p.wrappers);return f.prevObject=this,f.context=this.context,f}return this},$.fn.blast.defaults={returnGenerated:!0,delimiter:"word",tag:"span",search:!1,customClass:"",generateIndexID:!1,generateValueClass:!1,stripHTMLTags:!1,debug:!1}}(window.jQuery||window.Zepto,window,document);